<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url('https://themes.googleusercontent.com/fonts/css?kit=Lx1xfUTR4qFjwg0Z_pb901bqibjAC9TcrSzAoXtxa2E');ul.lst-kix_yaqq1qcrq5kv-1{list-style-type:none}ul.lst-kix_yaqq1qcrq5kv-2{list-style-type:none}.lst-kix_itm1c6sljamu-3>li:before{content:"\0025cf  "}.lst-kix_itm1c6sljamu-4>li:before{content:"\0025cb  "}ul.lst-kix_yaqq1qcrq5kv-0{list-style-type:none}.lst-kix_ldczo87a8ti-1>li:before{content:"\0025cb  "}.lst-kix_ldczo87a8ti-3>li:before{content:"\0025cf  "}.lst-kix_itm1c6sljamu-2>li:before{content:"\0025a0  "}.lst-kix_itm1c6sljamu-6>li:before{content:"\0025cf  "}.lst-kix_ldczo87a8ti-0>li:before{content:"\0025cf  "}.lst-kix_ldczo87a8ti-4>li:before{content:"\0025cb  "}.lst-kix_itm1c6sljamu-0>li:before{content:"\0025cf  "}.lst-kix_itm1c6sljamu-7>li:before{content:"\0025cb  "}.lst-kix_itm1c6sljamu-8>li:before{content:"\0025a0  "}ul.lst-kix_yaqq1qcrq5kv-7{list-style-type:none}ul.lst-kix_yaqq1qcrq5kv-8{list-style-type:none}ul.lst-kix_yaqq1qcrq5kv-5{list-style-type:none}ul.lst-kix_yaqq1qcrq5kv-6{list-style-type:none}.lst-kix_itm1c6sljamu-1>li:before{content:"\0025cb  "}ul.lst-kix_yaqq1qcrq5kv-3{list-style-type:none}ul.lst-kix_yaqq1qcrq5kv-4{list-style-type:none}.lst-kix_ldczo87a8ti-2>li:before{content:"\0025a0  "}.lst-kix_yaqq1qcrq5kv-8>li:before{content:"\0025a0  "}.lst-kix_yaqq1qcrq5kv-7>li:before{content:"\0025cb  "}.lst-kix_yaqq1qcrq5kv-5>li:before{content:"\0025a0  "}.lst-kix_yaqq1qcrq5kv-4>li:before{content:"\0025cb  "}.lst-kix_yaqq1qcrq5kv-6>li:before{content:"\0025cf  "}.lst-kix_itm1c6sljamu-5>li:before{content:"\0025a0  "}.lst-kix_yaqq1qcrq5kv-1>li:before{content:"\0025cb  "}.lst-kix_yaqq1qcrq5kv-0>li:before{content:"\0025cf  "}.lst-kix_yaqq1qcrq5kv-2>li:before{content:"\0025a0  "}.lst-kix_qlf8q75bx5jq-2>li:before{content:"\0025a0  "}.lst-kix_qlf8q75bx5jq-4>li:before{content:"\0025cb  "}.lst-kix_yaqq1qcrq5kv-3>li:before{content:"\0025cf  "}.lst-kix_qlf8q75bx5jq-1>li:before{content:"\0025cb  "}.lst-kix_qlf8q75bx5jq-5>li:before{content:"\0025a0  "}.lst-kix_qlf8q75bx5jq-3>li:before{content:"\0025cf  "}ul.lst-kix_ldczo87a8ti-6{list-style-type:none}ul.lst-kix_ldczo87a8ti-7{list-style-type:none}ul.lst-kix_ldczo87a8ti-8{list-style-type:none}ul.lst-kix_xtog4o9eevuh-8{list-style-type:none}ul.lst-kix_ldczo87a8ti-2{list-style-type:none}ul.lst-kix_ldczo87a8ti-3{list-style-type:none}ul.lst-kix_xtog4o9eevuh-6{list-style-type:none}ul.lst-kix_ldczo87a8ti-4{list-style-type:none}ul.lst-kix_xtog4o9eevuh-7{list-style-type:none}.lst-kix_qlf8q75bx5jq-0>li:before{content:"\0025cf  "}ul.lst-kix_ldczo87a8ti-5{list-style-type:none}ul.lst-kix_xtog4o9eevuh-4{list-style-type:none}ul.lst-kix_xtog4o9eevuh-5{list-style-type:none}ul.lst-kix_xtog4o9eevuh-2{list-style-type:none}ul.lst-kix_ldczo87a8ti-0{list-style-type:none}ul.lst-kix_xtog4o9eevuh-3{list-style-type:none}ul.lst-kix_ldczo87a8ti-1{list-style-type:none}ul.lst-kix_xtog4o9eevuh-0{list-style-type:none}ul.lst-kix_xtog4o9eevuh-1{list-style-type:none}.lst-kix_xtog4o9eevuh-4>li:before{content:"\0025cb  "}.lst-kix_xtog4o9eevuh-5>li:before{content:"\0025a0  "}.lst-kix_xtog4o9eevuh-8>li:before{content:"\0025a0  "}.lst-kix_xtog4o9eevuh-0>li:before{content:"\0025cf  "}.lst-kix_xtog4o9eevuh-6>li:before{content:"\0025cf  "}.lst-kix_xtog4o9eevuh-7>li:before{content:"\0025cb  "}ul.lst-kix_itm1c6sljamu-1{list-style-type:none}ul.lst-kix_itm1c6sljamu-2{list-style-type:none}ul.lst-kix_itm1c6sljamu-0{list-style-type:none}ul.lst-kix_itm1c6sljamu-5{list-style-type:none}.lst-kix_qlf8q75bx5jq-8>li:before{content:"\0025a0  "}ul.lst-kix_itm1c6sljamu-6{list-style-type:none}ul.lst-kix_itm1c6sljamu-3{list-style-type:none}ul.lst-kix_itm1c6sljamu-4{list-style-type:none}.lst-kix_qlf8q75bx5jq-6>li:before{content:"\0025cf  "}.lst-kix_xtog4o9eevuh-1>li:before{content:"\0025cb  "}.lst-kix_xtog4o9eevuh-2>li:before{content:"\0025a0  "}.lst-kix_xtog4o9eevuh-3>li:before{content:"\0025cf  "}.lst-kix_qlf8q75bx5jq-7>li:before{content:"\0025cb  "}ul.lst-kix_itm1c6sljamu-7{list-style-type:none}ul.lst-kix_itm1c6sljamu-8{list-style-type:none}ul.lst-kix_qlf8q75bx5jq-7{list-style-type:none}ul.lst-kix_qlf8q75bx5jq-8{list-style-type:none}ul.lst-kix_qlf8q75bx5jq-5{list-style-type:none}ul.lst-kix_qlf8q75bx5jq-6{list-style-type:none}.lst-kix_ldczo87a8ti-8>li:before{content:"\0025a0  "}ul.lst-kix_qlf8q75bx5jq-3{list-style-type:none}ul.lst-kix_qlf8q75bx5jq-4{list-style-type:none}ul.lst-kix_qlf8q75bx5jq-1{list-style-type:none}ul.lst-kix_qlf8q75bx5jq-2{list-style-type:none}.lst-kix_ldczo87a8ti-5>li:before{content:"\0025a0  "}.lst-kix_ldczo87a8ti-7>li:before{content:"\0025cb  "}ul.lst-kix_qlf8q75bx5jq-0{list-style-type:none}.lst-kix_ldczo87a8ti-6>li:before{content:"\0025cf  "}ol{margin:0;padding:0}table td,table th{padding:0}.c0{padding-top:0pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c10{padding-top:0pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:center}.c4{color:#000000;font-weight:normal;text-decoration:none;vertical-align:baseline;font-style:normal}.c9{color:#000000;text-decoration:none;vertical-align:baseline;font-style:normal}.c17{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c13{orphans:2;widows:2;text-align:center}.c7{font-size:18pt;font-family:"Helvetica Neue"}.c12{color:#1155cc;text-decoration:underline}.c16{color:inherit;text-decoration:inherit}.c8{padding:0;margin:0}.c18{orphans:2;widows:2}.c2{font-size:11pt;font-family:"Helvetica Neue"}.c11{font-size:14pt;font-family:"Helvetica Neue"}.c3{font-style:italic}.c6{font-weight:bold}.c1{height:12pt}.c5{margin-left:36pt}.c14{padding-left:0pt}.c15{text-indent:36pt}.title{padding-top:24pt;color:#000000;font-weight:bold;font-size:36pt;padding-bottom:6pt;font-family:"Times New Roman";line-height:1.0;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:18pt;color:#666666;font-size:24pt;padding-bottom:4pt;font-family:"Georgia";line-height:1.0;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:12pt;font-family:"Times New Roman"}p{margin:0;color:#000000;font-size:12pt;font-family:"Times New Roman"}h1{padding-top:24pt;color:#000000;font-weight:bold;font-size:24pt;padding-bottom:6pt;font-family:"Times New Roman";line-height:1.0;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-weight:bold;font-size:18pt;padding-bottom:4pt;font-family:"Times New Roman";line-height:1.0;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:14pt;color:#000000;font-weight:bold;font-size:14pt;padding-bottom:4pt;font-family:"Times New Roman";line-height:1.0;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:12pt;color:#000000;font-weight:bold;font-size:12pt;padding-bottom:2pt;font-family:"Times New Roman";line-height:1.0;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:11pt;color:#000000;font-weight:bold;font-size:11pt;padding-bottom:2pt;font-family:"Times New Roman";line-height:1.0;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:10pt;color:#000000;font-weight:bold;font-size:10pt;padding-bottom:2pt;font-family:"Times New Roman";line-height:1.0;page-break-after:avoid;orphans:2;widows:2;text-align:left}</style></head><body class="c17"><div><p class="c1 c18"><span></span></p></div><p class="c10"><span class="c11 c6">Project 2</span></p><p class="c10"><span class="c2">Nima Aghli,Mohammad Mahdi Seyednezhad,Shakre Elmane,Mengjin Ye </span></p><p class="c1 c10"><span class="c2"></span></p><p class="c13"><span class="c2 c6">Git Repository :</span></p><p class="c13"><span class="c12 c2"><a class="c16" href="https://www.google.com/url?q=https://github.com/nimaaghli/R12-Arm/tree/project2&amp;sa=D&amp;ust=1457821302616000&amp;usg=AFQjCNFeTqnqCibItdYyiaRuifZQiDgfLg">https://github.com/nimaaghli/R12-Arm/tree/project2</a></span></p><p class="c13 c1"><span class="c2"></span></p><p class="c0"><span class="c2">The goal of project 2 is to search and find an object placed on random place on &nbsp;the table and take a picture of it &nbsp;using R12 robotic arm and the camera it has in its end point.</span></p><p class="c0"><span class="c2 c6">Demo :</span></p><p class="c0"><span class="c2">Sequence of pictures taken when running code is located in example_images folder of project.(animated.gif would have better presentation of how algorithm work)</span></p><p class="c0 c1"><span class="c7 c6"></span></p><p class="c0"><span class="c7 c6">Computer Vision :</span></p><ul class="c8 lst-kix_xtog4o9eevuh-0 start"><li class="c0 c5 c14"><span class="c2 c6">SURF (Speeded-Up Robust Features) &nbsp;:</span></li></ul><p class="c0 c5"><span class="c2">Our approach to find the desired object in camera frames captured from camera attached to end point of arm was using SURF detector to find the object in area.this algorithm gets the reference image of object as its input and after generating its unique features it starts chaking same feature points in live feed camera frames while we are scanning area if it was able to find good matches between reference features and live feed images then the object is considered found in the picture.We have used OpenCV library for c++ to implement SURF detector in our project.</span></p><p class="c0 c1"><span class="c2"></span></p><ul class="c8 lst-kix_qlf8q75bx5jq-0 start"><li class="c0 c5 c14"><span class="c2 c6">Homography :</span></li></ul><p class="c0 c5"><span class="c2">As we find the good matches in image next step is to find transformation of the image in comparison to our reference image so we can take appropriate steps by arm to move the camera to center of object and take a picture of object. </span></p><p class="c0 c5"><span class="c2">Calculation of Homography matrix between reference image and the camera frame that we detect an object in it would help us to generate perspective transformation and as a result calculate the 4 corners of object in the camera frame. &nbsp;</span></p><p class="c0 c5"><span class="c2">OpenCV </span><span class="c2 c3">findHomography</span><span class="c2">&nbsp;function would find a perspective transformation between two planes.</span></p><p class="c0 c1"><span class="c7 c6"></span></p><p class="c0"><span class="c7 c6">Scan The Area : </span></p><p class="c0"><span class="c7 c6">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c2">In order to scan the area with robotic arm inverse kinematics was needed to be implemented in order to generate shoulder,elbow,wrist values to be send along AJMA command to robot.The </span><span class="c2 c3">invKinem</span><span class="c2">&nbsp;function in source code receives the radius and the Z value that we want to scan the area and returns a vector including the correct values for shoulder,elbow,wrist so we can send it as AJMA command to robot.</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c7 c6">Algorithm :</span></p><p class="c0"><span class="c2">First step is to run the scan function and start scanning the area while we take each move new picture is taken and send to the </span><span class="c2 c3">processimage</span><span class="c2">&nbsp;function .If object found the function will return the position of four corners of object in image the good advantage of calculating homography matrix is that the generated transformation matrix would also give us the corners of object even if they are are not in our image frame(part of object is outside of image) with negative values so that would help us take next step to move camera to exact center of object to take good picture(all of object inside the image).After calculation of 4 corners of object in image we calculate the center point of object as it is rectangle and compare it to the center of of our image then based on the distance they have from each other we calculate in which x,y direction we should move the arm in order to match center of object with the center of image frame coordinate as a result we ask our inverse kinematic function to to generate new values for us in order to move the arm close to center of object.As we match the center of object with center of our image frame coordinate the last picture is taken and the program ends. &nbsp;</span></p><p class="c0"><span class="c2">&nbsp;</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c4 c2">We have used curl c++ library to be able to send commands while the robot server answers only to http commands and OpenCv for computer &nbsp;vision </span><span class="c2">implementation</span><span class="c4 c2">.</span></p><p class="c0"><span class="c7">F</span><span class="c4 c7">unctions</span><span class="c4 c2">&nbsp;</span><span class="c2">:</span></p><p class="c0"><span class="c2 c6">vector&lt;cv::Point&gt; processimage(cv::Mat img1,cv::Mat img2);</span></p><p class="c0"><span class="c2">This function receives 2 image matrix img1 as the reference image and img2 as the camera image to be matched if the match found the function returns the vector including 4 corners of detected object. </span></p><p class="c0"><span class="c2 c6">sendcommand_AJMA(int hand,int wrist,int elbow,int shoulder,int waist);</span></p><p class="c0"><span class="c2">Sends AJMA command to robot.</span></p><p class="c0"><span class="c9 c2 c6">captureImage();</span></p><p class="c0"><span class="c4 c2">Calling This function will send a image capture command to server in order to take a picture with the camera </span><span class="c2">connect</span><span class="c4 c2">&nbsp;to endpoint of arm.</span></p><p class="c0"><span class="c4 c2">The taken picture will be saved in this link http://debatedecide.fit.edu/robot/last.bmp</span></p><p class="c0"><span class="c2 c6">cv::Mat </span><span class="c9 c2 c6">saveImage(string path_to_images);</span></p><p class="c0"><span class="c4 c2">This function downloads the latest image taken by captureImage(); and saves it to the path given by user as a parameter to function.The </span><span class="c2">message</span><span class="c4 c2">&nbsp;will be returned based on if the execution was successful or failed with error message .</span></p><p class="c0"><span class="c2">This function returns the saved image as matrix to be used for image processing.</span></p><p class="c0"><span class="c9 c2 c6">sendCommand_TMOVETO(int hand,int wrist,int x,int y,int z);</span></p><p class="c0"><span class="c4 c2">Calling this function will send a TMOVETO command to arm with the parameters hand as hand position , wrist as wrist position and x,y,z parameters for the robot to move endpoint to desired x,y,z position.</span></p><p class="c0"><span class="c9 c2 c6">sendCommand_HOME();</span></p><p class="c0"><span class="c4 c2">This Function will send a command to arm to go its home position.</span></p><p class="c0"><span class="c9 c2 c6">captureSave(std::string path);</span></p><p class="c0"><span class="c4 c2">This Function is combination of function capture image and save image with will constantly take picture and save it to the path defined by user as a input parameter to function</span></p><p class="c0"><span class="c6">vector&lt;long&gt; invKinem(double r ,double z);</span></p><p class="c0"><span>This Function receives the radius and and the z values that we would like to scan the area from above and generates the correct AJMA values and returns it as a vector.</span></p><p class="c0 c1"><span class="c6"></span></p><p class="c0 c1"><span class="c6"></span></p><p class="c0 c1"><span></span></p><p class="c0 c1"><span></span></p><p class="c0 c1"><span></span></p><p class="c0 c1"><span></span></p><p class="c0 c1"><span></span></p><p class="c0 c1"><span></span></p><p class="c0 c1"><span></span></p><p class="c0"><span class="c6 c11">How </span><span class="c9 c11 c6">to run code :</span></p><p class="c0"><span class="c4 c2">&nbsp;</span></p><p class="c0"><span class="c4 c2">This code needs curl lib to compile :</span></p><p class="c0 c1"><span class="c2 c6"></span></p><p class="c0"><span class="c9 c2 c6">Install curl in ubuntu:</span></p><p class="c0 c1"><span></span></p><p class="c0"><span class="c4 c2">&nbsp; &nbsp; sudo apt-get install curl</span></p><p class="c0 c1"><span></span></p><p class="c0"><span class="c2 c6 c9">Install curl in Mac :</span></p><p class="c0 c1"><span></span></p><p class="c0"><span class="c2 c4">&nbsp; &nbsp; sudo apt-get install curl</span></p><p class="c0 c1"><span></span></p><p class="c0"><span class="c4 c2">or</span></p><p class="c0 c1"><span></span></p><p class="c0"><span class="c4 c2">&nbsp; &nbsp; brew install curl</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2 c6">Install OpenCV Ubuntu :</span></p><p class="c0"><span class="c2"># install dependencies<br>sudo apt-get update<br>sudo apt-get install -y build-essential<br>sudo apt-get install -y cmake<br>sudo apt-get install -y libgtk2.0-dev<br>sudo apt-get install -y pkg-config<br>sudo apt-get install -y python-numpy python-dev<br>sudo apt-get install -y libavcodec-dev libavformat-dev libswscale-dev<br>sudo apt-get install -y libjpeg-dev libpng-dev libtiff-dev libjasper-dev<br> <br>sudo apt-get -qq install libopencv-dev build-essential checkinstall cmake pkg-config yasm libjpeg-dev libjasper-dev libavcodec-dev libavformat-dev libswscale-dev libdc1394-22-dev libxine-dev libgstreamer0.10-dev libgstreamer-plugins-base0.10-dev libv4l-dev python-dev python-numpy libtbb-dev libqt4-dev libgtk2.0-dev libmp3lame-dev libopencore-amrnb-dev libopencore-amrwb-dev libtheora-dev libvorbis-dev libxvidcore-dev x264 v4l-utils<br> <br># download opencv-2.4.11<br>wget http://downloads.sourceforge.net/project/opencvlibrary/opencv-unix/2.4.11/opencv-2.4.11.zip<br>unzip opencv-2.4.11.zip<br>cd opencv-2.4.11<br>mkdir release<br>cd release<br> <br># compile and install<br>cmake -G &quot;Unix Makefiles&quot; -D CMAKE_CXX_COMPILER=/usr/bin/g++ CMAKE_C_COMPILER=/usr/bin/gcc -D CMAKE_BUILD_TYPE=RELEASE -D CMAKE_INSTALL_PREFIX=/usr/local -D WITH_TBB=ON -D BUILD_NEW_PYTHON_SUPPORT=ON -D WITH_V4L=ON -D INSTALL_C_EXAMPLES=ON -D INSTALL_PYTHON_EXAMPLES=ON -D BUILD_EXAMPLES=ON -D WITH_QT=ON -D WITH_OPENGL=ON -D BUILD_FAT_JAVA_LIB=ON -D INSTALL_TO_MANGLED_PATHS=ON -D INSTALL_CREATE_DISTRIB=ON -D INSTALL_TESTS=ON -D ENABLE_FAST_MATH=ON -D WITH_IMAGEIO=ON -D BUILD_SHARED_LIBS=OFF -D WITH_GSTREAMER=ON ..</span></p><p class="c0"><span class="c2"><br>make all -j4 # 4 cores<br></span></p><p class="c0"><span class="c2">sudo make install</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c6">Install OpenCV On Mac: </span></p><p class="c0 c15"><span>brew tap homebrew/science</span></p><p class="c0 c15"><span>brew info opencv</span></p><p class="c0 c15"><span>brew install opencv</span></p><p class="c0"><span class="c6">Download Latest Code : </span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Git clone </span><span class="c2 c12"><a class="c16" href="https://www.google.com/url?q=https://github.com/nimaaghli/R12-Arm/tree/project2&amp;sa=D&amp;ust=1457821302634000&amp;usg=AFQjCNGa5LdVErEVpWD5-7qcpC4LDylTQA">https://github.com/nimaaghli/R12-Arm/tree/project2</a></span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Git checkout project2</span></p><p class="c0"><span class="c9 c2 c6">Compile </span><span class="c2 c6">A</span><span class="c9 c2 c6">nd </span><span class="c2 c6">R</span><span class="c9 c2 c6">un :</span></p><p class="c0 c1"><span></span></p><p class="c0"><span class="c4 c2">&nbsp; &nbsp; cd R12-Arm</span></p><p class="c0 c1"><span></span></p><p class="c0"><span class="c4 c2">&nbsp; &nbsp; make</span></p><p class="c0 c1"><span></span></p><p class="c0"><span class="c4 c2">&nbsp; &nbsp; ./arm &lt;Password&gt; &lt;</span><span class="c2">Folder To Save Images</span><span class="c4 c2">&gt; &lt;Direction to </span><span class="c2">reference</span><span class="c4 c2">&nbsp;image to be found &gt;</span></p><div><p class="c18 c1"><span></span></p></div></body></html>